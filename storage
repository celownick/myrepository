pages:
  stage: deploy
  allow_failure: false
  dependencies:
    - run-test
  only:
    refs:
      - merge_request
      - schedules
      - pipelines
  script:
    - echo "Creating public directory for pipeline $CI_PIPELINE_ID"
    - mkdir -p public/$CI_PIPELINE_ID
    - echo "Copying reports to public/$CI_PIPELINE_ID"
    - cp -r target/cucumber-reports-ext/cucumber-html-reports/* public/$CI_PIPELINE_ID/
    - mv public/$CI_PIPELINE_ID/overview-features.html public/$CI_PIPELINE_ID/index.html
    - echo "Report available at: $CI_PAGES_URL/$CI_PIPELINE_ID"
    - echo "$CI_PAGES_URL/$CI_PIPELINE_ID" > public/$CI_PIPELINE_ID/report_url.txt
  artifacts:
    paths:
      - public
    expire_in: 30 days
